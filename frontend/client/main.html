<head>
  <title>Token auction</title>
</head>

<body>
  <div class="container">
    <div class="row">
      <div class="col-cs-12">
        <h1>Token Auction</h1>
        {{> networkStatus}}
        {{> balance}}
      </div>
    </div>
    <div class="row">
      <div class="col-cs-12">
        {{> auction}}
      </div>
    </div>
    <div class="row">
      <div class="col-cs-12">
        {{> auctionlet}}
      </div>
    </div>
    <div class="row">
      <div class="col-cs-12">
        {{> newauction}}
      </div>
    </div>
  </div>
</body>

<template name="balance">
  <h2>Balance</h2>
  <table class="table table-condensed">
    <tr>
      <td>Account</td>
      <td><a href="http://testnet.etherscan.io/address/{{mkrAddress}}">{{account}}</a></td>
    </tr>
    <tr>
      <td><a href="http://testnet.etherscan.io/address/{{MKRToken.address}}">{{MKRToken.name}}</a></td>
      <td>{{formatBalance (fromWei MKRToken.balance)}}</td>
    </tr>
    <tr>
      <td><a href="http://testnet.etherscan.io/address/{{ETHToken.address}}">{{ETHToken.name}}</a></td>
      <td>{{formatBalance (fromWei ETHToken.balance)}}</td>
    </tr>
  </table>
</template>

<template name="auction">
  <h2>Auction</h2>
  {{#unless auctionNotFound}}
  <table class="table table-condensed">
    <tr>
      <td>Contract address</td>
      <td><a href="http://testnet.etherscan.io/address/{{contractaddress}}" target="_blank">{{contractaddress}}</a></td>
    </tr>
    <tr>
      <td>Auction id</td>
      <td>{{auction.auctionId}}</td>
    </tr>
    <tr>
      <td>Creator</td>
      <td><a href="http://testnet.etherscan.io/address/{{auction.creator}}" target="_blank">{{auction.creator}}</a></td>
    </tr>
    <tr>
      <td>Selling</td>
      <td>{{formatBalance (fromWei auction.sell_amount)}} <a href="http://testnet.etherscan.io/address/{{MKRToken.address}}" target="_blank">{{MKRToken.name}}</a></td>
    </tr>
    <tr>
      <td>Start bid</td>
      <td>{{formatBalance (fromWei auction.start_bid)}} <a href="http://testnet.etherscan.io/address/{{ETHToken.address}}" target="_blank">{{ETHToken.name}}</a></td>
    </tr>
    <tr>
      <td>Minimum increase</td>
      <td>{{auction.min_increase}}%</td>
    </tr>
    <tr>
      <td>Duration</td>
      <td>{{auction.duration}} seconds</td>
    </tr>
  </table>
  {{else}}
 <span>Auction was not found</span>
 {{/unless}}
</template>

<template name="auctionlet">
  <h2>Auctionlet</h2>
  {{#unless auctionNotFound}}
    <table class="table">
      <tr>
        <td>Auctionlet id</td>
        <td>{{auctionlet.auctionletId}}</td>
      </tr>
      {{#if unclaimed}}
      <tr>
        <td>Selling</td>
        <td>{{formatBalance (fromWei auctionlet.sell_amount)}} <a href="http://testnet.etherscan.io/address/{{MKRToken.address}}" target="_blank">{{MKRToken.name}}</a></td>
      </tr>
      {{#unless auctionlet.base}}
        <tr>
          <td>Last bidder</td>
          <td><a href="http://testnet.etherscan.io/address/{{auctionlet.last_bidder}}">{{auctionlet.last_bidder}}</a></td>
        </tr>
        <tr>
          <td>Last bid time</td>
          <td>{{auctionlet.last_bid_time}}</td>
        </tr>
      {{/unless}}
      <tr>
        {{#if auctionlet.base}}
          <td>Initial bid</td>
        {{else}}
          <td>Highest bid</td>
        {{/if}}
        <td>{{formatBalance (fromWei auctionlet.buy_amount)}} <a href="http://testnet.etherscan.io/address/{{ETHToken.address}}" target="_blank">{{ETHToken.name}}</a></td>
      </tr>
      {{/if}}
    </table>
    {{#unless expired}}
    <div class="form-group">
      <label for="inputBid">Enter a bid for the auctionlet</label>
      <input class="form-control" id="inputBid" type="number" min="{{bid}}" value="{{bid}}" {{b "value: bid"}}>
      <button class="btn btn-primary" {{b "click: create"}}>Place bid</button>
      {{#if bidMessage}}
        <span id='spnBidMessage'>{{ bidMessage }}</span>
      {{/if}}
    </div>
    {{else}}
    <div class="form-group">
      <span>Auctionlet has expired.</span>
      {{#unless unclaimed}}
        <br/>
        <span>The tokens have been claimed by the auctionlet winner</span>
      {{/unless}}    
      {{#if auctionwinner}}
        {{#if auctionlet.unclaimed}}
          <span>You made the highest bid. Click to receive the tokens</span>
          <button class="btn btn-primary" {{b "click: claim"}}>Claim</button>
          {{#if claimMessage}}
            <span id='spnClaimMessage'>{{ claimMessage }}</span>
          {{/if}}
        {{/if}}
      {{/if}}
    </div>
    {{/unless}}
  {{else}}
    <span>Auctionlet was not found</span>
  {{/unless}}
</template>

<template name="newauction">
  <h2>New auction</h2>
  <table>
    <tbody>
      <tr>
        <td>Sell amount</td>
        <td><input type="number" min="0" {{b "value: sellamount"}}> <a href="http://testnet.etherscan.io/address/{{MKRToken.address}}" target="_blank">{{MKRToken.name}}</a></td>
      </tr>
      <tr>
        <td>Start bid</td>
        <td><input type="number" min="0" {{b "value: startbid"}}> <a href="http://testnet.etherscan.io/address/{{ETHToken.address}}" target="_blank">{{ETHToken.name}}</a></td>
      </tr>
      <tr>
        <td>Minimum increase</td>
        <td><input type="number" min="1" step="1" {{b "value: minimumincrease"}}> %</td>
      </tr>
      <tr>
        <td>Duration</td>
        <td><input type="number" min="0" {{b "value: duration"}}> seconds</td>
      </tr>
    </tbody>
    <tfoot>
      <tr>
        <td><button class="btn btn-primary" {{b "click: create"}}>Create auction</button></td>
      </tr>
      {{#if newAuctionMessage}}
        <tr>
          <td><span id='newAuctionMessage'>{{newAuctionMessage}}</span></td>
        </tr>
      {{/if}}
    </tfoot>
  </table>
</template>

<template name="transactions">
  <h2>Transactions</h2>
  <table class="table table-condensed">
    {{#each transactions}}
    <tr>
      <td>{{type}}</td>
      <td>{{tx}}</td>
      <td>{{json object}} </td>
    </tr>
    {{/each}}
  </table>
</template>

<template name="tokens">
  <h2>Tokens</h2>
  <table class="table table-condensed">
    <th>
        <td>Token id</td>
        <td>Balance</td>
        <td>Allowance</td>
    </th>
    {{#each tokens}}
    <tr>
      <td>{{name}}</td>
      <td>{{balance}}</td>
      <td>{{allowance}} </td>
    </tr>
    {{/each}}
  </table>
</template>